<div id="main_container">
  <img class="post__image--extra-narrow intro-img" src="images/blog/dataviz.jpg" alt="">
  <div class="text-container ui text container">
    <h3>Analyzing Data Visulization</h3>
    <h4>Using the clinicaltrials.gov Database </h4>
    <h1 class="ui center aligned header article-header">Introduction - Background</h1>
    <!-- <img class="ui h4 left floated image" src="images/blog/post-1/punch.gif"> -->
    <p>
      Looking at pictures is the simplest and most effective way to describe, explore, and summarize information about a set of numbers. Graphs display measured quantities using points, lines, a coordinate system, numbers, symbols, words, and color. Also, graphs serve a clear purpose by using a description, tabulation, and decoration. Information visualization, displaying huge quantities of data in an effective manner, is a simple and powerful technique that allows users to draw conclusions based on the patterns and relationships that the data is showing. Information visualization such as graphs show the data by making large data sets coherent, allowing comparison of different pieces of data, and reveal both a broad overview and fine details.
    </p>
    <p>
      Clinical trials, experiments done in clinical research, play an important role in allowing new inventions to come to market, as they verify the intended product’s safety and efficacy. Prospective studies enroll human participants or patients to perform research studies that produce new treatments and further study known interventions. Depending on product type and development stage, clinical trials can vary in duration and enrollment size. Data on the aforementioned attributes was retrieved from the clinicaltrials.gov database and visualized to gain a further understanding of what makes graphs effective and discern patterns in clinical trials.
    </p>
    <p>
      Presenting information visually allows us to gain insights that would be difficult or impossible to do from the same data presented textually. Most data analysis involves discovering the relationship among values which exhibits themselves as patterns, trends, and exceptions. However, understanding the data is not the end goal of the visualizations, rather reaching actionable information is. Good data analysis allows users to understand what is currently going on and be able to predict what will happen under particular conditions in the future. 
    </p>
    <h1  class="ui center aligned header article-header">Methods and Procedures</h1>
    <p>
      The two prerequisites for effectively analyzing data visually is having a way to present information and good data to analyze. The linchpin of any scientific visualization is data that is well structured, atomic, accurate, and has a high volume. Notably, any data analysis is only as accurate as the data itself and data that is accurate, free of error, and complete is critical. Similarly, data that is well structured allows users to easily access the information they desire. The data was downloaded from clincialtrials.gov database in xml format, parsed using the ruby language, and graphed using excel and D3.js.
    </p>
    <p>
      After looking at schema illustrating how the data was stored, and retrieving relevant data several calculations were performed to illustrate information visualization best practices and techniques. To determine the division of the trials and each divisions prevalence, each trial was accounted by the date the trial was started and its category and then grouped by year. The total number of trials is displayed using a pie chart, a bar chart, and a line chart. In addition, a stacked bar chart was used to further explore the relationship. Subsequently, the rate of change in trial growth was calculated and plotted to further explore the relationship. Additionally, the duration of trials who reported both a start date and end date was calculated, grouped by months, and the top 20 duration frequencies was plotted using a scatterplot. Similarly, the size of enrollment for each trial was collected, grouped by order of 10, and the top 20 enrollment size frequencies was plotted using a scatterplot.
    </p>
    <h1 class="ui center aligned header article-header">Results and discussion</h1>
    <p>
      “Although graphs inform us differently than spoken or written words, both involve language: one is visual and the other verbal.” Particularly, low-level characteristics of objects called pre-attentive attributes are easily noticed by our visual receptors and processed before conscious attention.  Length, width, shape, color, and position are basic pre-attentive attributes that can be used to display data in a rapidly perceptible and easily graspable manner. Properly designed graphs allow patterns, that reveal what the information means, to be easily spotted even after brief exposure. Also, presenting numbers in portion to the numerical quantity measured, and clear, detailed, and through labeling to exclude graphical distorting and ambiguity are two principles that can help achieve graphical integrity. Using a caption to give an explanation of the data, and label important events in the data makes graphs more comprehensible. Each part of a graph generates visual expectations about its other parts and help determine what the eye sees. A scale moving in regular intervals is expected to continue its march to the end in a consistent fashion, without muddling non-uniform changes. In general graphs are wider than taller, but taller graphs can be helped used to emphasize the picture of rapid growth. 
    </p>
    <p>
      While pictures are great, allowing more information to be chunked together and retained at once, they are not always needed if the amount of information needed to be conveyed is within the “working-memory” of the user, as is the case with the table below. The table below, directly copied, shows the type of studies performed and gives a further breakdown of the type of intervention used.  Assessing the type of intervention requires tracking 4 values, which is manageable and doesn’t require a picture a picture.
    </p>
    <img class="d3_viz" src="images/blog/post-2/fig1.png" alt="">
    <img class="d3_viz" src="images/blog/post-2/fig2.png" alt="">
    <p>
      While looking at the categories and count of trials, the pie chart doesn’t work as well since in order to analyze it we must compare 2-D areas or the angle formed by the slices, neither accurately supported by visual perception. On the contrary, the bar graph on the right supports comparison quite due to the length of the bars, which display differences in magnitude and make it easy to compare. In addition, bar graphs should be used to emphasize the individuality of values since the bars have great visual weight and independence from one another. While bar charts do show the difference between the branches, they do not compare the same branch over different period of time and are inferior to time-series plots. 
    </p>
    <img class="d3_viz" src="images/blog/post-2/fig3.png" alt="">
    <p>
      Time-series plot is the most frequently used form of graphic design. With a dimension used to portray time it gives this design a strength and efficiency of interpretation found in no other graphs. They are best used to displaying big data sets with real variability rather than simple linear changes. While bar graphs are used to show the difference between the branches, without time there is no shape given to the quantitates, which is the main advantage of graphs. Conversely, line graphs do a great job of showing the overall trend specific pattern of shape of change from one value to the next, especially through time. While noting the change of the amount of trials through time in each category reveals an interesting aspect of the whole picture, it is enlightening to see the rate of change from one value to the next expressed as the percentage difference between the two.
    </p>
    <img class="d3_viz" src="images/blog/post-2/fig4.png" alt="">
    <p>
      The majority of graphs (40%) have a relational form, with two or more variables, none of which are time.  Relational forms (scatterplot) link at least two variables encouraging the viewer to assess the possible relationship between the plotted variables. It challenges the theory that X causes Y with empirical evidence as to the actual relationship between the two variables. However, some times due to overlapping it is hard to see individual points and asses the full picture. Consequently, reducing the size of the data objects alleviates over-lapping and allows multiple data points that fight for the same location to be more clearly seen. Additionally, changing the shape of the markers, removing their fill, and changing the transparency can help individual points and trends stand out more. 
    </p>
    <img class="d3_viz" src="images/blog/post-2/fig5.png" alt="">
    <img class="d3_viz" src="images/blog/post-2/fig6.png" alt="">
    <img class="d3_viz" src="images/blog/post-2/fig7.png" alt="">
    <h1  class="ui center aligned header article-header">Conclusion<br></h1>
    <p>
      In order to use visualizations appropriately, it is crucial to understand how visual
      perception works and then display data visually in ways that follows the rules. Rather than simply
      display data graphically, effective information visualization is dependent on understanding how
      we see and think. To visually represent quantitative data, we must use perceptual building blocks
      consisting of objects and their properties (such as pre-attentive attributes) that are well received by
      our visual perception. When viewing a visualization, we engage in making comparisons and
      examining quantitative relationships such as time-series, distributions, and correlations which
      manifest themselves as patterns, trends, and exceptions. The goal of analyzing a visualization is to
      understand what these relationships mean so we can make good decisions.
    </p>
  </div>
</div>

<div id="dataviz_container" class="ui text container">
  <p>
    <h2> More Graphs</h2>
    <div id="pie_chart" class="jumbotron">
      <div class="chart_title">
        <h1 class="ui center aligned header article-header">Donut Chart</h1>
        <p>Distribution of total studies by categories</p>
      </div>
      <div id="pie_chart_d3">
      </div>
    </div>
    <div id="line_chart" class="jumbotron">
      <div class="chart_title">
        <h1 class="ui center aligned header article-header">Line Chart</h1>
        <p>Total trials by category over time</p>
      </div>
      <div id="line_chart_d3">
      </div>
    </div>
    <div id="grouped_bar_chart" class="jumbotron">
      <div class="chart_title">
        <h1 class="ui center aligned header article-header">Grouped Bar Chart</h1>
        <p>Total trials by category over time</p>
      </div>
      <div id="grouped_bar_chart_d3">
      </div>
    </div>
    <div id="stacked_area_chart" class="jumbotron">
      <div class="chart_title">
        <h1 class="ui center aligned header article-header">Stacked Area Chart</h1>
        <p>Total trials(%) by category over time</p>
      </div>
      <div id="stack_area_chart_d3">
      </div>
    </div>
    <div id="stacked_group_bar_chart" class="jumbotron">
      <div class="chart_title">
        <h1 class="ui center aligned header article-header">Stacked Group Bar Chart</h1>
        <p>Total trials(%) by category over time</p>
      </div>
      <div id="stacked_group_bar_chart_d3">
      </div>
    </div>
  </p>
</div>

<script type="text/javascript">
  var line_graph = function line_graph(){
    var margin = {top: 20, right: 80, bottom: 30, left: 50},
        width = 760 - margin.left - margin.right,
        height = 450 - margin.top - margin.bottom;

    var parseDate = d3.time.format("%Y").parse;

    var x = d3.time.scale()
        .range([0, width]);

    var y = d3.scale.linear()
        .range([height, 0]);

    var color = d3.scale.category10();

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left");

    var line = d3.svg.line()
        .interpolate("basis")
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.temperature); });

    var svg = d3.select("#line_chart_d3").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("https://s3-us-west-2.amazonaws.com/dotaempower/dataviz/data.csv", function(error, data) {
      if (error) throw error;

      color.domain(d3.keys(data[0]).filter(function(key) { return key !== "date"; }));

      data.forEach(function(d) {
        d.date = parseDate(d.year);
        console.log(d.date);
      });

      var cities = color.domain().map(function(name) {
        return {
          name: name,
          values: data.map(function(d) {
            return {date: d.date, temperature: +d[name]};
          })
        };
      });

      x.domain(d3.extent(data, function(d) { return d.date; }));

      y.domain([
        d3.min(cities, function(c) { return d3.min(c.values, function(v) { return v.temperature; }); }),
        d3.max(cities, function(c) { return d3.max(c.values, function(v) { return v.temperature; }); })
      ]);

      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
        .append("text")
          .attr("color","white")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Number of trials");

      var city = svg.selectAll(".city")
          .data(cities)
        .enter().append("g")
          .attr("class", "city");

      city.append("path")
          .attr("class", "line")
          .attr("d", function(d) { return line(d.values); })
          .style("stroke", function(d) { return color(d.name); });

      city.append("text")
          .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
          .attr("transform", function(d) { return "translate(" + x(d.value.date) + "," + y(d.value.temperature) + ")"; })
          .attr("x", 3)
          .attr("dy", ".35em")
          .text(function(d) { return d.name; });
    });
  }
</script>


<script>
  var stacked_area_chart = function stacked_area_chart(){
    var margin = {top: 20, right: 20, bottom: 30, left: 50},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var parseDate = d3.time.format("%Y").parse,
        formatPercent = d3.format(".0%");

    var x = d3.time.scale()
        .range([0, width]);

    var y = d3.scale.linear()
        .range([height, 0]);

    var color = d3.scale.category20();

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .tickFormat(formatPercent);

    var area = d3.svg.area()
        .x(function(d) { return x(d.date); })
        .y0(function(d) { return y(d.y0); })
        .y1(function(d) { return y(d.y0 + d.y); });

    var stack = d3.layout.stack()
        .values(function(d) { return d.values; });

    var svg = d3.select("#stack_area_chart_d3").append("svg")        
                .attr('viewBox','0 0 870 450')
                .attr('preserveAspectRatio','xMinYMin')
                .append("g")
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("https://s3-us-west-2.amazonaws.com/dotaempower/dataviz/data2.csv", function(error, data) {
      if (error) throw error;
      console.log(data);

      color.domain(d3.keys(data[0]).filter(function(key) { return key !== "date"; }));

      data.forEach(function(d) {
        d.date = parseDate(d.date);
      });

      var browsers = stack(color.domain().map(function(name) {
        return {
          name: name,
          values: data.map(function(d) {
            return {date: d.date, y: d[name] / 100};
          })
        };
      }));

      x.domain(d3.extent(data, function(d) { return d.date; }));


      var browser = svg.selectAll(".browser")
          .data(browsers)
        .enter().append("g")
          .attr("class", "browser");

      browser.append("path")
          .attr("class", "area")
          .attr("d", function(d) { return area(d.values); })
          .style("fill", function(d) { return color(d.name); });

      browser.append("text")
          .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
          .attr("transform", function(d) { return "translate(" + x(d.value.date) + "," + y(d.value.y0 + d.value.y / 2) + ")"; })
          .attr("x", -6)
          .attr("dy", ".35em")
          .text(function(d) { return d.name; });

      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      svg.append("g")
          .attr("class", "y axis")
          .call(yAxis);
    });
  };
</script>

<script type="text/javascript">
  var stacked_bar_chart = function stacked_bar_chart(){
    var causes = ["behvariour","wound","immune","digestive","cancer"];

    var parseDate = d3.time.format("%Y").parse;

    var margin = {top: 20, right: 50, bottom: 30, left: 20},
        width = 1000 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width]);

    var y = d3.scale.linear()
        .rangeRound([height, 0]);

    var z = d3.scale.category20();

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom")
        .tickFormat(d3.time.format("%y"));

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("right");

    var svg = d3.select("#grouped_bar_chart_d3").append("svg")
                .attr("viewBox",'0 0 1060 530')
                .attr("preserveAspectRatio", "xMidYMax")
                .append("g")
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("https://s3-us-west-2.amazonaws.com/dotaempower/dataviz/data3.csv", type, function(error, crimea) {
      if (error) throw error;

      var layers = d3.layout.stack()(causes.map(function(c) {
        return crimea.map(function(d) {
          return {x: d.date, y: d[c]};
        });
      }));

      x.domain(layers[0].map(function(d) { return d.x; }));
      y.domain([0, d3.max(layers[layers.length - 1], function(d) { return d.y0 + d.y; })]).nice();

      var layer = svg.selectAll(".layer")
          .data(layers)
        .enter().append("g")
          .attr("class", "layer")
          .style("fill", function(d, i) { return z(i); });

      layer.selectAll("rect")
          .data(function(d) { return d; })
        .enter().append("rect")
          .attr("x", function(d) { return x(d.x); })
          .attr("y", function(d) { return y(d.y + d.y0); })
          .attr("height", function(d) { return y(d.y0) - y(d.y + d.y0); })
          .attr("width", x.rangeBand() - 1);

      svg.append("g")
          .attr("class", "axis axis--x")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      svg.append("g")
          .attr("class", "axis axis--y")
          .attr("transform", "translate(" + width + ",0)")
          .call(yAxis);

      svg.select(".x.axis")
          .selectAll("text")
          // To rotate the texts on x axis. Translate y position a little bit to prevent overlapping on axis line.
          .style("font-size","15px");
    });

    function type(d) {
      d.date = parseDate(d.date);
      causes.forEach(function(c) { d[c] = +d[c]; });
      return d;
    }
  } 
</script>

<script type="text/javascript">
  var stacked_bar_chart_2 = function stacked_bar_chart_2(){
    
    var margin = {top: 20, right: 60, bottom: 30, left: 40},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;
    
    var parseDate = d3.time.format("%Y").parse;
    
    var y = d3.scale.ordinal()
        .rangeRoundBands([height, 0], .1);

    var x = d3.scale.linear()
        .rangeRound([0, width]);

    var color = d3.scale.category20();

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .tickFormat(d3.time.format("%Y"));

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom")
        .tickFormat(d3.format(".2s"));

    var svg = d3.select("#stacked_group_bar_chart_d3").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("https://s3-us-west-2.amazonaws.com/dotaempower/dataviz/data2.csv", function(error, data) {
      if (error) throw error;

      color.domain(d3.keys(data[0]).filter(function(key) { return key !== "date"; }));

      data.forEach(function(d) {
        var y0 = 0;
        d.ages = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
        d.total = d.ages[d.ages.length - 1].y1;
        d.date = parseDate(d.date);
        console.log(d);
      });

      data.sort(function(a, b) { return b.total - a.total; });

      y.domain(data.map(function(d) { return d.date; }));
      x.domain([0, d3.max(data, function(d) { return d.total; })]);

      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
        .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Population");

      var state = svg.selectAll(".state")
          .data(data)
          .enter().append("g")
          .attr("class", "g")
          .attr("transform", function(d) { return "translate(0," + y(d.date) + ")"; });

      state.selectAll("rect")
          .data(function(d) { return d.ages; })
          .enter().append("rect")
          .attr("height", y.rangeBand())
          .attr("x", function(d) { return x(d.y0); })
          .attr("width", function(d) { return x(d.y1) - x(d.y0); })
          .style("fill", function(d) { return color(d.name); });

      var legend = svg.selectAll(".legend")
          .data(color.domain().slice().reverse())
        .enter().append("g")
          .attr("class", "legend")
          .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

      legend.append("rect")
          .attr("x", width + 40)
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", color);

      legend.append("text")
          .attr("x", width + 35)
          .attr("y", 9)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function(d) { return d; });
    });
  }
</script>

<script type="text/javascript">
  (function(d3) {
    'use strict';

    var dataset = [
      { label: 'immune', count: 9399 },
      { label: 'Digestive', count: 18928 }, 
      { label: 'cancer', count: 15686 },
      { label: 'wound', count: 10496 },
      { label: 'behvaiour', count: 9021 }
    ];

    var width = 360;
    var height = 360;
    var radius = Math.min(width, height) / 2;
    var donutWidth = 40;
    var legendRectSize = 18;                                  // NEW
    var legendSpacing = 4;                                    // NEW

    var color = d3.scale.category20();

    var svg = d3.select('#pie_chart_d3')
      .append('svg')
      .attr('width', width)
      .attr('height', height)
      .append('g')
      .attr('transform', 'translate(' + (width / 2) + 
        ',' + (height / 2) + ')');

    var arc = d3.svg.arc()
      .innerRadius(radius - donutWidth)
      .outerRadius(radius);

    var pie = d3.layout.pie()
      .value(function(d) { return d.count; })
      .sort(null);

    var path = svg.selectAll('path')
      .data(pie(dataset))
      .enter()
      .append('path')
      .attr('d', arc)
      .attr('fill', function(d, i) { 
        return color(d.data.label);
      });

    var legend = svg.selectAll('.legend')                     // NEW
      .data(color.domain())                                   // NEW
      .enter()                                                // NEW
      .append('g')                                            // NEW
      .attr('class', 'legend')                                // NEW
      .attr('transform', function(d, i) {                     // NEW
        var height = legendRectSize + legendSpacing;          // NEW
        var offset =  height * color.domain().length / 2;     // NEW
        var horz = -2 * legendRectSize;                       // NEW
        var vert = i * height - offset;                       // NEW
        return 'translate(' + horz + ',' + vert + ')';        // NEW
      });                                                     // NEW

    legend.append('rect')                                     // NEW
      .attr('width', legendRectSize)                          // NEW
      .attr('height', legendRectSize)                         // NEW
      .style('fill', color)                                   // NEW
      .style('stroke', color);                                // NEW
      
    legend.append('text')                                     // NEW
      .attr('x', legendRectSize + legendSpacing)              // NEW
      .attr('y', legendRectSize - legendSpacing)              // NEW
      .text(function(d) { return d; });                       // NEW
  })(window.d3);
</script>


<script type="text/javascript">
  // line_graph();
  stacked_area_chart();
  stacked_bar_chart();
  stacked_bar_chart_2();
</script>